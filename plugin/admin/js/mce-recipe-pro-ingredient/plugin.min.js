/**
 * plugin.js
 *
 * Released under LGPL License.
 * Copyright (c) 1999-2015 Ephox Corp. All rights reserved
 *
 * License: http://www.tinymce.com/license
 * Contributing: http://www.tinymce.com/contributing
 */

/*global tinymce:true */
//Editor#addVisual(elm:Element):undefined


tinymce.PluginManager.add('recipeproingredient', function(ed) {

	ed.on('change', function(e) {
		e = e.target;Â 
		// if (e.nodeName === 'IMG' && editor.dom.hasClass(e, pageBreakClass)) {
		// 	editor.selection.select(e);
		// }
		console.log(e);
		console.log("what");
		window.RecipePro.currentRecipe.ingestIngredients(ed.getBody());
	});

  ed.addButton('recipepro_setasheader', {
    title : 'Set as Header',
    cmd : 'recipepro_setasheader',
    icon: 'plus'
  });
  ed.addCommand('recipepro_setasheader', function() {
    if (ed.selection.getNode().nodeName == "P") {
      var $a = jQuery('<h4>' + jQuery(ed.selection.getNode()).html() + '</h4>');
      var replacement = jQuery(ed.selection.getNode()).replaceWith($a);
    }
  });

  ed.addButton('recipepro_removeasheader', {
    title : 'Remove as Header',
    cmd : 'recipepro_removeasheader',
    icon: 'minus'
  });
  ed.addCommand('recipepro_removeasheader', function() {
    if (ed.selection.getNode().nodeName == "H4") {
      var $a = jQuery('<p>' + jQuery(ed.selection.getNode()).html() + '</p>');
      var replacement = jQuery(ed.selection.getNode()).replaceWith($a);
    }
  });

	// function isIngredient(obj) {

	// 	var selectorMatched = editor.dom.is(obj, 'p') && editor.getBody().contains(obj);

	// 	return selectorMatched;
	// }
	// var toolbarItems = 'bold';
	// editor.addContextToolbar(
	// 			isIngredient,
	// 			toolbarItems
	// 		);

	// editor.on('BeforeSetContent', function(e) {
	// 	e.content = e.content.replace(pageBreakSeparatorRegExp, pageBreakPlaceHolderHtml);
	// });

	// editor.on('PreInit', function() {
	// 	editor.serializer.addNodeFilter('img', function(nodes) {
	// 		var i = nodes.length, node, className;

	// 		while (i--) {
	// 			node = nodes[i];
	// 			className = node.attr('class');
	// 			if (className && className.indexOf('mce-pagebreak') !== -1) {
	// 				// Replace parent block node if pagebreak_split_block is enabled
	// 				var parentNode = node.parent;
	// 				if (editor.schema.getBlockElements()[parentNode.name] && editor.settings.pagebreak_split_block) {
	// 					parentNode.type = 3;
	// 					parentNode.value = separatorHtml;
	// 					parentNode.raw = true;
	// 					node.remove();
	// 					continue;
	// 				}

	// 				node.type = 3;
	// 				node.value = separatorHtml;
	// 				node.raw = true;
	// 			}
	// 		}
	// 	});
	// });
});
//# sourceURL=mce-recipe-pro-ingredient/plugin.min.js